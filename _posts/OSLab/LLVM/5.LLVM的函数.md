---
title:  5.LLVM的函数
date: 2016-12-24 18:35:26 # 文章生成时间，一般不改
categories:   # 文章分类目录，参数可省略
    - OSLab
    - LLVM
tags:   # 文章标签，参数可省略
---
## 参考文档
[使用LLVM框架创建一个工作编译器](http://www.ibm.com/developerworks/cn/opensource/os-createcompilerllvm1/)

## LLVM模块和上下文环境
LLVM 模块类是其他所有 LLVM IR 对象的顶级容器。LLVM 模块类能够包含全局变量、函数、该模块所依赖的其他模块和符号表等对象的列表。这里将提供了 LLVM 模块的构造函数：
```
explicit Module(StringRef ModuleID, LLVMContext& C);
```

## 通过在doxygen的Classes中的Class Index来查找Function等类和里面的函数，然后点击右上角的List of all members
### Function
#### 构造一个函数的类型：
```
FunctionType * FunctionType::get	(	Type * 	Result,
ArrayRef< Type * > 	Params,
bool 	isVarArg
)		[static]

IntegerType *IntTy32 = IntegerType::get(mod->getContext(), 32);
	std::vector<Type*>FuncTy_args;
	FuncTy_args.push_back(IntTy32);
	FuncTy_args.push_back(IntTy32);
FunctionType* FuncTy = FunctionType::get(/*Result=*/Type::getVoidTy(mod->getContext()),
  											 /*Params=*/FuncTy_args,
											 /*isVarArg=*/false);

```
#### 创建一个函数(先判断是否存在，若不存在则create)：
```
static Function* llvm::Function::Create	(	FunctionType * 	Ty,
LinkageTypes 	Linkage,
const Twine & 	N = "",
Module * 	M = nullptr
)		[inline, static]
func = Function::Create(/*Type=*/FuncTy,
									/*Linkage=*/GlobalValue::ExternalLinkage,
									/*Name=*/"MyRecord", mod);

void llvm::Function::setCallingConv	(	CallingConv::ID 	CC	)
func->setCallingConv(CallingConv::C);

void llvm::Function::setAttributes	(	AttributeSet 	Attrs	)
func->setAttributes(func_Add_PAL);

```
