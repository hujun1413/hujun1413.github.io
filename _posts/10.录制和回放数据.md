---
title:  10.录制和回放数据
date: 2016-09-29 20:35:26 # 文章生成时间，一般不改
categories:   # 文章分类目录，参数可省略
    - OSLab
    - ROS
tags:   # 文章标签，参数可省略
---
## 录制数据（通过创建一个bag文件）
```linux
roscore
rosrun turtlesim turtlesim_node 
rosrun turtlesim turtle_teleop_key
```
键盘控制turtle运动一起
<!--more-->
### 录制所有发布的话题
```linux
rostopic list -v
```
现在我们开始录制。打开一个新的终端窗口，在终端中执行以下命令：
```linux
mkdir ~/bagfiles
cd ~/bagfiles
rosbag record -a
```
在这里我们先建立一个用于录制的临时目录，然后在该目录下运行rosbag record命令，并附加-a选项，该选项表示将当前发布的所有话题数据都录制保存到一个bag文件中。
### 检查并回放bag文件
```linux
rosbag info 2016-09-28-22-47-42.bag
rosbag play 2016-09-28-22-47-42.bag
```
默认模式下，rosbag play命令在公告每条消息后会等待一小段时间（0.2秒）后才真正开始发布bag文件中的内容。等待一段时间的过程可以通知消息订阅器消息已经公告了消息数据可能会马上到来。如果rosbag play在公告消息后立即发布，订阅器可能会接收不到几条最先发布的消息。等待时间可以通过-d选项来指定。

最终/turtle1/command_velocity话题将会被发布，同时在turtuelsim虚拟画面中turtle应该会像之前你通过turtle_teleop_key节点控制它一样开始移动。从运行rosbag play到turtle开始移动时所经历时间应该近似等于之前在本教程开始部分运行rosbag record后到开始按下键盘发出控制命令时所经历时间。你可以通过-s参数选项让rosbag play命令等待一段时间跳过bag文件初始部分后再真正开始回放。最后一个可能比较有趣的参数选项是-r选项，它允许你通过设定一个参数来改变消息发布速率。如果你执行：

```linux
rosbag play -r 2 2016-09-28-22-47-42.bag
```

你应该会看到turtle的运动轨迹有点不同了，这时的轨迹应该是相当于当你以两倍的速度通过按键发布控制命令时产生的轨迹。
### 录制数据子集
```linux
rosbag record -O subset /turtle1/cmd_vel /turtle1/pose
```
上述命令中的-O参数告诉rosbag record将数据记录保存到名为subset.bag的文件中，同时后面的话题参数告诉rosbag record只能录制这两个指定的话题。
### rosbag record/play 命令的局限性
在前述部分中你可能已经注意到了turtle的路径可能并没有完全地映射到原先通过键盘控制时产生的路径上——整体形状应该是差不多的，但没有完全一样。造成该问题的原因是turtlesim的移动路径对系统定时精度的变化非常敏感。rosbag受制于其本身的性能无法完全复制录制时的系统运行行为，rosplay也一样。对于像turtlesim这样的节点，当处理消息的过程中系统定时发生极小变化时也会使其行为发生微妙变化，用户不应该期望能够完美的模仿系统行为。